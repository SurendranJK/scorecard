!doctype html
html lang=en
head
meta charset=utf-8
meta name=viewport content=width=device-width,initial-scale=1
titleScoreCard — Hewlett Packard Enterprisetitle
style
  root{--hpe-blue#00739D;--hpe-dark#0b3b4a;--muted#4d5a63;--bg#f4f7f8;--panel#ffffff;--panel-weak#f1f7fb}
  {box-sizingborder-box}
  body{margin0;font-familyInter, Segoe UI, Arial;colorvar(--muted);backgroundvar(--bg);-webkit-font-smoothingantialiased}
  .container{max-width1200px;margin28px auto;padding18px}
  .topbar{displayflex;align-itemscenter;justify-contentspace-between;gap12px}
  .brand{displayflex;align-itemscenter;gap12px}
  .brand .title{font-weight700;colorvar(--hpe-blue);font-size20px}
  .brand .subtitle{font-size13px;color#2c4b56}
  .controls{displayflex;gap8px;align-itemscenter}
  .controls select,.controls button,.controls input{padding8px 10px;border-radius8px;border1px solid #d7e6eb;backgroundwhite}
  .main-card{margin-top16px;backgroundvar(--panel);border-radius12px;padding18px;box-shadow0 8px 28px rgba(10,20,30,0.06)}
  .top-stats{displayflex;gap14px;flex-wrapwrap}
  .stat-card{flex1 1 30%;min-width220px;backgroundvar(--panel-weak);padding18px;border-radius8px;border1px solid #e5f0f5;opacity0;transformtranslateY(8px);transitionall .45s ease}
  .stat-card.show{opacity1;transformnone}
  .stat-label{font-size13px;color#6d7c84}
  .stat-value{font-size22px;font-weight700;colorvar(--hpe-dark);margin-top8px}
  .grid{displaygrid;grid-template-columns1fr 420px;gap14px;margin-top18px}
  .panel{backgroundvar(--panel);padding14px;border-radius8px;border1px solid #eaf5f9}
  .panel h3{margin0;colorvar(--hpe-blue);font-size16px}
  table{width100%;border-collapsecollapse;margin-top10px}
  th,td{padding8px;border-bottom1px solid #eef6f9;font-size13px;text-alignleft}
  thead th{backgroundvar(--hpe-blue);colorwhite;font-weight600}
  .muted{color#64767d;font-size13px}
  .actions{displayflex;gap10px;align-itemscenter}
  .small{font-size12px;padding6px 8px}
  .bottom-note{margin-top12px;color#66787f;font-size13px}
  .info { padding12px; border-radius8px; background#fff9e6; border1px solid #ffdca8; color#6a4b00; margin-bottom12px; }
  .error { padding12px; border-radius8px; background#fff1f1; border1px solid #f2b0b0; color#8b1a1a; margin-bottom12px; }
  @media (max-width980px){.grid{grid-template-columns1fr}.stat-card{min-widthunset}}
  @media print{.controls, .topbar .actions {displaynone} body{backgroundwhite}}
  .right-controls {displayflex; align-itemscenter; gap8px;}
  .id-input {width120px}
  .label-inline {font-size13px;color#6b7b86;margin-right6px}
style
head
body
  div class=container
    div class=topbar
      div class=brand
        div
          div class=titleScoreCarddiv
          div class=subtitleHewlett Packard Enterprise — Live Performancediv
        div
      div

      div class=controls
        div class=mutedMonthdiv
        select id=monthSelect title=Select monthselect

        div class=right-controls
          span class=label-inlineEmployee IDspan
          input id=empInput class=id-input type=text placeholder=eg 60154741 
          button id=apply class=smallApplybutton
          button id=refresh class=smallRefreshbutton
          button id=print class=smallPrintbutton
        div
      div
    div

    div class=main-card
      div id=status class=mutedLoading data…div

      div id=contentArea style=displaynone
        div class=top-stats id=topStatsdiv

        div class=grid
          div class=panel id=leftPanel
            h3PMPI Scoreh3
            div id=pmpiArea class=muted style=margin-top10pxLoading PMPI…div
          div

          div class=panel id=rightPanel
            h3Riders  Parametersh3
            div id=riderArea class=muted style=margin-top10pxLoading Riders…div
          div
        div

        div class=bottom-noteMake sure your Google Sheet is published (File → Publish to the web). Data updates when sheet updates.div
      div

      div id=debugBox style=displaynone;margin-top12px;div
    div
  div

script

  Final ScoreCard index.html
  - Reads OpenSheet JSON from your published sheet (edit OPENSHEET if you change sheet)
  - Employee ID input + Month dropdown
  - Friendly No data found messages when row is missing
  - Tolerant header detection and title-row handling


(async function(){
   ---------- CONFIG ----------
  const OPENSHEET = httpsopensheet.elk.sh1D7If5Nf1i2_f3OvUCxySkrE_IWUy_YgSl95-hDPDinwscores;
  const AUTO_REFRESH_MS = 0;  set 0 to auto refresh in ms

   ui refs
  const status = document.getElementById('status');
  const contentArea = document.getElementById('contentArea');
  const debugBox = document.getElementById('debugBox');
  const topStats = document.getElementById('topStats');
  const pmpiArea = document.getElementById('pmpiArea');
  const riderArea = document.getElementById('riderArea');
  const monthSelect = document.getElementById('monthSelect');
  const empInput = document.getElementById('empInput');
  const btnApply = document.getElementById('apply');
  const btnRefresh = document.getElementById('refresh');
  const btnPrint = document.getElementById('print');

  const monthNames = [January,February,March,April,May,June,July,August,September,October,November,December];
  const params = new URLSearchParams(window.location.search);
  let EMP_ID = (params.get('id')  '').trim();
  const URL_PERIOD = (params.get('period')  '').trim();
  const URL_YEAR = params.get('year');
  const URL_MONTH = params.get('month');

  if (EMP_ID) empInput.value = EMP_ID;

  function showStatus(msg, isError=false){
    if (isError) {
      status.innerHTML = `span class=error${msg}span`;
    } else {
      status.innerHTML = `span class=info${msg}span`;
    }
  }

  async function fetchSheet(){
    showStatus('Fetching sheet...');
    const res = await fetch(OPENSHEET, {cache'no-store'});
    if (!res.ok) throw new Error('Failed to fetch sheet ' + res.status);
    return res.json();
  }

   normalize rows if first row is a title, treat second row as headers
  function normalize(rows){
    if (!rows  !rows.length) return [];
    const firstKeys = Object.keys(rows[0]{}).map(k=String(k).trim());
    const looksLikeTitle = firstKeys.length === 1  firstKeys.every(k = ^[dW]+$.test(k)  k.length  4);
    if (looksLikeTitle && rows.length  1){
      const headers = Object.values(rows[1]).map(v = String(v'').trim());
      const dataRows = rows.slice(2);
      if (headers.every(h = h)){
        return dataRows.map(r = {
          const vals = Object.values(r);
          const obj = {};
          headers.forEach((h,i)= obj[h] = vals[i]  '');
          return obj;
        });
      }
    }
    return rows;
  }

  function collectPeriods(rows){
    const ks = Object.keys(rows[0]{});
    const periodKey = ks.find(k=periodi.test(k));
    if (periodKey) return [...new Set(rows.map(r=String(r[periodKey]'').trim()).filter(Boolean))].sort().reverse();
    const yearKey = ks.find(k=yeari.test(k));
    const monthKey = ks.find(k=monthi.test(k));
    if (yearKey && monthKey){
      const set = new Set();
      rows.forEach(r={
        const y = String(r[yearKey]'').trim();
        let m = String(r[monthKey]'').trim();
        if (m && m.length===1) m = '0'+m;
        if (y && m) set.add(`${y}-${m}`);
      });
      return [...set].sort().reverse();
    }
    return [];
  }

  function detectIdKey(row){
    return Object.keys(row{}).find(k=empidi.test(k))  Object.keys(row{})[0];
  }

  function findRecord(rows, emp, period){
    const idKey = detectIdKey(rows[0]{});
    const ks = Object.keys(rows[0]{});
    const periodKey = ks.find(k=periodyeari.test(k));
    if (period && periodKey) {
      return rows.find(r = (String(r[idKey]'').trim() === emp) && (String(r[periodKey]'').trim() === period));
    }
    const matches = rows.filter(r = String(r[idKey]'').trim() === emp);
    return matches.length  matches[0]  null;
  }

  function findKey(rec, patterns){
    const ks = Object.keys(rec{});
    for (const p of patterns){
      const re = new RegExp(p,'i');
      const found = ks.find(k=re.test(k));
      if (found) return found;
    }
    return null;
  }

  function renderTopStats(rec){
    topStats.innerHTML = '';
    const rows = [
      {label'Engineer Name', val rec[ findKey(rec,['name','engineer']) ]  rec['Engineer Name']  ''},
      {label'Onsite Response Met%', val rec[ findKey(rec,['onsite','response']) ]  rec['Onsite Response Met%']  '--'},
      {label'Overall SLA%', val rec[ findKey(rec,['overall','SLA']) ]  rec['Overall SLA%']  '--'},
      {label'TOTAL CLOSED VOLUME', val rec[ findKey(rec,['total','volume','closed']) ]  rec['TOTAL CLOSED VOLUME']  '--'},
      {label'TTR Hours (Official)', val rec[ findKey(rec,['ttr','TTR']) ]  '--'},
      {label'100% DA', val rec[ findKey(rec,['da','100%']) ]  rec['100% DA']  '--'},
      {label'PPMD', val rec[ findKey(rec,['ppmd']) ]  '--'},
      {label'PPMC', val rec[ findKey(rec,['ppmc']) ]  '--'},
      {label'ECASE SLA HG', val rec[ findKey(rec,['hg','ECASE SLA HG']) ]  rec['ECASE SLA_HG']  '--'}
    ];
    rows.forEach((r,i)={
      const div = document.createElement('div');
      div.className = 'stat-card';
      div.innerHTML = `div class=stat-label${r.label}divdiv class=stat-value${r.val}div`;
      topStats.appendChild(div);
      setTimeout(()=div.classList.add('show'), 120  i);
    });
  }

  function renderPMPI(rec){
    pmpiArea.innerHTML = 'div class=mutedNo PMPI datadiv';
    const key = findKey(rec, ['pmpi','p m p i','pm pi','pmpi score']);
    if (!key) return;
    let data = [];
    try { data = JSON.parse(rec[key]); }
    catch(e){
      const s = String(rec[key]'').trim();
      if (!s) return;
      data = s.split(rn).map(line={
        const parts = line.split('').map(x=x.trim());
        return {paramparts[0], actualparts[1], scoreparts[2]};
      }).filter(x=x.param);
    }
    if (!data.length) return;
    let html = 'tabletheadtrthParametersththActualththPMPI Scorethtrtheadtbody';
    data.forEach(d = html += `trtd${d.param''}tdtd${d.actual''}tdtd${d.score''}tdtr`);
    html += 'tbodytable';
    pmpiArea.innerHTML = html;
  }

  function renderRiders(rec){
    riderArea.innerHTML = 'div class=mutedNo RidersParametersdiv';
    const riderKey = findKey(rec, ['rider','riders']);
    const paramKey = findKey(rec, ['parameter','parameters','param']);
    let html = '';
    if (riderKey && rec[riderKey]) {
      try {
        const arr = JSON.parse(rec[riderKey]);
        if (Array.isArray(arr) && arr.length) {
          html += 'h4 style=margin0 0 6px 0Ridersh4tabletheadtrthParameterththActualththScorethtrtheadtbody';
          arr.forEach(a = html += `trtd${a.parama[0]''}tdtd${a.actuala[1]''}tdtd${a.scorea[2]''}tdtr`);
          html += 'tbodytable';
        }
      } catch(e){}
    }
    if (paramKey && rec[paramKey]) {
      try {
        const parr = JSON.parse(rec[paramKey]);
        if (Array.isArray(parr) && parr.length) {
          html += 'h4 style=margin12px 0 6px 0Parametersh4tabletheadtrthParameterththScorethtrtheadtbody';
          parr.forEach(p = html += `trtd${p.paramp[0]''}tdtd${p.scorep[1]''}tdtr`);
          html += 'tbodytable';
        }
      } catch(e){}
    }
    if (html) riderArea.innerHTML = html;
  }

   ---------------- load() with friendly messages ----------------
  async function load(){
    try {
      const r = await fetch(OPENSHEET, {cache'no-store'});
      if (!r.ok) throw new Error('Failed to fetch sheet ' + r.status);
      const raw = await r.json();
      const rows = normalize(raw  []);

      if (!rows.length) {
        showStatus('No data in sheet', true);
        contentArea.style.display = 'none';
        debugBox.style.display = 'none';
        monthSelect.innerHTML = 'option value=No monthsoption';
        return;
      }

      showStatus('Sheet loaded — ' + rows.length + ' rows');

      const periods = collectPeriods(rows);
      monthSelect.innerHTML = 'option value=Latestoption';
      periods.forEach(p = {
        const [y,m] = p.split('-');
        const formatted = (monthNames[parseInt(m,10)-1]  m) + ' ' + y;
        const o = document.createElement('option'); o.value = p; o.textContent = formatted; monthSelect.appendChild(o);
      });

      if (URL_PERIOD) monthSelect.value = URL_PERIOD;

       prefer typed input, else URL param
      EMP_ID = (empInput.value  EMP_ID  '').trim();
      if (EMP_ID) empInput.value = EMP_ID;

      let target = URL_PERIOD  (URL_YEAR && URL_MONTH  `${URL_YEAR}-${String(URL_MONTH).padStart(2,'0')}`  '');
      if (!target && periods.length) target = periods[0];

      const rec = findRecord(rows, EMP_ID, target);

      if (!rec) {
        const periodPretty = target  ((monthNames[parseInt(target.split('-')[1],10)-1]  target.split('-')[1]) + ' ' + target.split('-')[0])  'latest';
        const empText = EMP_ID  `Employee ${EMP_ID}`  'Employee (none)';
        const msg = `No data found for ${empText} in ${periodPretty}.`;
        showStatus(msg, true);
        contentArea.style.display = 'none';
        debugBox.style.display = 'none';
        return;
      }

       render the UI
      contentArea.style.display = 'block';
      debugBox.style.display = 'none';
      renderTopStats(rec);
      renderPMPI(rec);
      renderRiders(rec);

      const prettyTarget = target  ((monthNames[parseInt(target.split('-')[1],10)-1]  target.split('-')[1]) + ' ' + target.split('-')[0])  '';
      showStatus(`Showing ${EMP_ID}${prettyTarget  ' — ' + prettyTarget  ''}`, false);

    } catch (err) {
      showStatus('Error ' + err.message, true);
      console.error(err);
    }
  }

   initial load
  await load();

   UI actions
  btnApply.onclick = () = {
    const chosenMonth = monthSelect.value;
    const typedId = (empInput.value  '').trim();
    const q = new URLSearchParams(window.location.search);
    if (typedId) q.set('id', typedId);
    if (chosenMonth) q.set('period', chosenMonth); else q.delete('period');
    window.location.search = q.toString();  reloads page with new params
  };
  btnRefresh.onclick = () = load();
  btnPrint.onclick = () = window.print();

  if (AUTO_REFRESH_MS  0) setInterval(load, AUTO_REFRESH_MS);

})();
script
body
html
